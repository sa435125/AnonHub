-- AnonHub: Enhanced UI with Login System, VIP Section, Better Layout, FPS Counter, and User Detection

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

if playerGui:FindFirstChild("AnonHub") then
    playerGui:FindFirstChild("AnonHub"):Destroy()
end

-- User Detection System Integration
_G.AnonHubMainLoaded = true

-- Configuration
local VALID_KEY = "anonhub-release-CSA)!84)$" -- Change this to your desired key
local DISCORD_LINK = "https://discord.gg/xbEM8Jhv4W"

-- User Detection Konfiguration
local USER_DETECTION = {
    ENABLED = true,
    INDICATOR_TEXT = "🔥 AnonHub",
    INDICATOR_COLOR = Color3.fromRGB(255, 215, 0), -- Gold wie VIP
    DETECTION_DISTANCE = 150,
    UPDATE_INTERVAL = 3,
    SHOW_NOTIFICATIONS = true,
}

-- Globale Variablen für User Detection
local detectedUsers = {}
local userIndicators = {}

-- Define COLORS table BEFORE using it
local COLORS = {
    BG_MAIN = Color3.fromRGB(26, 29, 38),
    BG_SIDEBAR = Color3.fromRGB(34, 36, 46),
    BG_SIDEBAR_BTN = Color3.fromRGB(47, 50, 65),
    BG_SIDEBAR_BTN_SELECTED = Color3.fromRGB(65, 110, 225),
    BG_VIP = Color3.fromRGB(255, 215, 0),
    BG_SCRIPT = Color3.fromRGB(37, 42, 60),
    BG_SCRIPT_BADGE = Color3.fromRGB(70, 200, 120),
    BG_SEARCH = Color3.fromRGB(44, 52, 68),
    BG_SCROLLBAR = Color3.fromRGB(100, 120, 210),
    TXT_MAIN = Color3.fromRGB(235, 235, 245),
    TXT_ACCENT = Color3.fromRGB(91, 133, 255),
    TXT_MUTED = Color3.fromRGB(170, 178, 200),
    TXT_PLACEHOLDER = Color3.fromRGB(140, 145, 170),
    TXT_BADGE = Color3.fromRGB(255,255,255),
    TXT_SIDEBAR_SELECTED = Color3.fromRGB(255,255,255),
    TXT_SIDEBAR = Color3.fromRGB(220,220,230),
    TXT_VIP = Color3.fromRGB(0, 0, 0),
    WATERMARK = Color3.fromRGB(91, 133, 255),
    BORDER = Color3.fromRGB(50, 60, 85),
    GREEN = Color3.fromRGB(40, 220, 100),
    RED = Color3.fromRGB(220, 60, 60),
    FPS_BG = Color3.fromRGB(50, 60, 85),
}

local ICONS = {
    Homepage = "rbxassetid://7733960981",
    Scripts = "rbxassetid://7734068321",
    Utility = "rbxassetid://7734008670",
    VIP = "rbxassetid://7733955511",
    ["Social Media"] = "rbxassetid://7733911827",
}

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AnonHub"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.Parent = playerGui

-- FPS Counter variables
local lastUpdate = tick()
local frameCount = 0
local fps = 0

-- Top Status Bar (made wider to accommodate FPS)
local statusBar = Instance.new("Frame")
statusBar.Size = UDim2.new(0, 260, 0, 45)
statusBar.Position = UDim2.new(0.5, -180, 0, 10)
statusBar.BackgroundColor3 = COLORS.BG_SIDEBAR
statusBar.BorderSizePixel = 0
statusBar.ZIndex = 200
statusBar.Parent = screenGui
local statusBarCorner = Instance.new("UICorner")
statusBarCorner.CornerRadius = UDim.new(0, 12)
statusBarCorner.Parent = statusBar

-- Status icons and buttons
local statusItems = {
    {icon = "👑", text = "USER", color = COLORS.BG_VIP, textColor = COLORS.TXT_VIP},
}

for i, item in ipairs(statusItems) do
    local statusItem = Instance.new("Frame")
    statusItem.Size = UDim2.new(0, 65, 0, 30)
    statusItem.Position = UDim2.new(0, 10 + (i-1) * 70, 0, 7.5)
    statusItem.BackgroundColor3 = item.color
    statusItem.BorderSizePixel = 0
    statusItem.ZIndex = 201
    statusItem.Parent = statusBar
    local statusItemCorner = Instance.new("UICorner")
    statusItemCorner.CornerRadius = UDim.new(0, 8)
    statusItemCorner.Parent = statusItem
    
    local statusIcon = Instance.new("TextLabel")
    statusIcon.Text = item.icon
    statusIcon.Font = Enum.Font.Gotham
    statusIcon.TextSize = 16
    statusIcon.TextColor3 = item.textColor
    statusIcon.BackgroundTransparency = 1
    statusIcon.Size = UDim2.new(0, 20, 1, 0)
    statusIcon.Position = UDim2.new(0, 5, 0, 0)
    statusIcon.ZIndex = 202
    statusIcon.Parent = statusItem
    
    local statusText = Instance.new("TextLabel")
    statusText.Text = item.text
    statusText.Font = Enum.Font.GothamBold
    statusText.TextSize = 12
    statusText.TextColor3 = item.textColor
    statusText.BackgroundTransparency = 1
    statusText.Size = UDim2.new(0, 35, 1, 0)
    statusText.Position = UDim2.new(0, 25, 0, 0)
    statusText.TextXAlignment = Enum.TextXAlignment.Left
    statusText.ZIndex = 202
    statusText.Parent = statusItem
end

-- FPS Counter in the middle
local fpsFrame = Instance.new("Frame")
fpsFrame.Size = UDim2.new(0, 80, 0, 30)
fpsFrame.Position = UDim2.new(0, 85, 0, 7.5)
fpsFrame.BackgroundColor3 = COLORS.FPS_BG
fpsFrame.BorderSizePixel = 0
fpsFrame.ZIndex = 201
fpsFrame.Parent = statusBar
local fpsFrameCorner = Instance.new("UICorner")
fpsFrameCorner.CornerRadius = UDim.new(0, 8)
fpsFrameCorner.Parent = fpsFrame

local fpsIcon = Instance.new("TextLabel")
fpsIcon.Text = "📊"
fpsIcon.Font = Enum.Font.Gotham
fpsIcon.TextSize = 16
fpsIcon.TextColor3 = COLORS.TXT_MAIN
fpsIcon.BackgroundTransparency = 1
fpsIcon.Size = UDim2.new(0, 20, 1, 0)
fpsIcon.Position = UDim2.new(0, 5, 0, 0)
fpsIcon.ZIndex = 202
fpsIcon.Parent = fpsFrame

local fpsLabel = Instance.new("TextLabel")
fpsLabel.Text = "60 FPS"
fpsLabel.Font = Enum.Font.GothamBold
fpsLabel.TextSize = 12
fpsLabel.TextColor3 = COLORS.TXT_MAIN
fpsLabel.BackgroundTransparency = 1
fpsLabel.Size = UDim2.new(0, 50, 1, 0)
fpsLabel.Position = UDim2.new(0, 25, 0, 0)
fpsLabel.TextXAlignment = Enum.TextXAlignment.Left
fpsLabel.ZIndex = 202
fpsLabel.Parent = fpsFrame

-- AnonHub Button (Main Hub Toggle) - Adjusted position
local hubToggleBtn = Instance.new("TextButton")
hubToggleBtn.Text = "AnonHub"
hubToggleBtn.Font = Enum.Font.GothamBlack
hubToggleBtn.TextSize = 14
hubToggleBtn.TextColor3 = COLORS.TXT_ACCENT
hubToggleBtn.BackgroundColor3 = COLORS.BG_MAIN
hubToggleBtn.Size = UDim2.new(0, 70, 0, 30)
hubToggleBtn.Position = UDim2.new(0, 175, 0, 7.5)
hubToggleBtn.BorderSizePixel = 0
hubToggleBtn.ZIndex = 201
hubToggleBtn.Parent = statusBar
local hubToggleCorner = Instance.new("UICorner")
hubToggleCorner.CornerRadius = UDim.new(0, 8)
hubToggleCorner.Parent = hubToggleBtn

-- FPS Update Function
local function updateFPS()
    frameCount = frameCount + 1
    local currentTime = tick()
    
    if currentTime - lastUpdate >= 1 then
        fps = math.floor(frameCount / (currentTime - lastUpdate))
        frameCount = 0
        lastUpdate = currentTime
        
        -- Update FPS display
        fpsLabel.Text = fps .. " FPS"
        
        -- Change color based on FPS
        if fps >= 50 then
            fpsLabel.TextColor3 = COLORS.GREEN
        elseif fps >= 30 then
            fpsLabel.TextColor3 = Color3.fromRGB(255, 165, 0) -- Orange
        else
            fpsLabel.TextColor3 = COLORS.RED
        end
    end
end

-- Connect FPS counter to RunService
RunService.Heartbeat:Connect(updateFPS)

-- Login Frame
local loginFrame = Instance.new("Frame")
loginFrame.Size = UDim2.new(0, 400, 0, 300)
loginFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
loginFrame.BackgroundColor3 = COLORS.BG_MAIN
loginFrame.BorderColor3 = COLORS.BORDER
loginFrame.BorderSizePixel = 1
loginFrame.ZIndex = 1000
loginFrame.Parent = screenGui
local loginCorner = Instance.new("UICorner")
loginCorner.CornerRadius = UDim.new(0, 20)
loginCorner.Parent = loginFrame

local loginTitle = Instance.new("TextLabel")
loginTitle.Text = "AnonHub Login"
loginTitle.Font = Enum.Font.GothamBlack
loginTitle.TextSize = 28
loginTitle.TextColor3 = COLORS.TXT_ACCENT
loginTitle.BackgroundTransparency = 1
loginTitle.Size = UDim2.new(1, 0, 0, 50)
loginTitle.Position = UDim2.new(0, 0, 0, 20)
loginTitle.ZIndex = 1001
loginTitle.Parent = loginFrame

local keyBox = Instance.new("TextBox")
keyBox.PlaceholderText = "Enter Access Key"
keyBox.Text = ""
keyBox.Font = Enum.Font.Gotham
keyBox.TextSize = 18
keyBox.TextColor3 = COLORS.TXT_MAIN
keyBox.BackgroundColor3 = COLORS.BG_SEARCH
keyBox.Size = UDim2.new(0, 300, 0, 40)
keyBox.Position = UDim2.new(0.5, -150, 0, 90)
keyBox.BorderSizePixel = 0
keyBox.ZIndex = 1001
keyBox.PlaceholderColor3 = COLORS.TXT_PLACEHOLDER
keyBox.Parent = loginFrame
local keyBoxCorner = Instance.new("UICorner")
keyBoxCorner.CornerRadius = UDim.new(0, 10)
keyBoxCorner.Parent = keyBox

local loginBtn = Instance.new("TextButton")
loginBtn.Text = "Login"
loginBtn.Font = Enum.Font.GothamBold
loginBtn.TextSize = 20
loginBtn.TextColor3 = COLORS.TXT_MAIN
loginBtn.BackgroundColor3 = COLORS.BG_SIDEBAR_BTN_SELECTED
loginBtn.Size = UDim2.new(0, 140, 0, 40)
loginBtn.Position = UDim2.new(0.5, -70, 0, 150)
loginBtn.ZIndex = 1001
loginBtn.Parent = loginFrame
local loginBtnCorner = Instance.new("UICorner")
loginBtnCorner.CornerRadius = UDim.new(0, 10)
loginBtnCorner.Parent = loginBtn

local getKeyBtn = Instance.new("TextButton")
getKeyBtn.Text = "Get Key"
getKeyBtn.Font = Enum.Font.GothamBold
getKeyBtn.TextSize = 18
getKeyBtn.TextColor3 = COLORS.TXT_MAIN
getKeyBtn.BackgroundColor3 = COLORS.BG_SIDEBAR_BTN
getKeyBtn.Size = UDim2.new(0, 120, 0, 35)
getKeyBtn.Position = UDim2.new(0.5, -60, 0, 210)
getKeyBtn.ZIndex = 1001
getKeyBtn.Parent = loginFrame
local getKeyBtnCorner = Instance.new("UICorner")
getKeyBtnCorner.CornerRadius = UDim.new(0, 8)
getKeyBtnCorner.Parent = getKeyBtn

local statusLabel = Instance.new("TextLabel")
statusLabel.Text = ""
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextSize = 16
statusLabel.TextColor3 = COLORS.TXT_MUTED
statusLabel.BackgroundTransparency = 1
statusLabel.Size = UDim2.new(1, 0, 0, 30)
statusLabel.Position = UDim2.new(0, 0, 0, 260)
statusLabel.ZIndex = 1001
statusLabel.Parent = loginFrame

-- Notification System
local notifyFrame = Instance.new("Frame")
notifyFrame.AnchorPoint = Vector2.new(0.5, 1)
notifyFrame.Position = UDim2.new(0.5, 0, 1, -18)
notifyFrame.Size = UDim2.new(0, 340, 0, 44)
notifyFrame.BackgroundTransparency = 1
notifyFrame.ZIndex = 999
notifyFrame.Parent = screenGui

local notifyLabel = Instance.new("TextLabel")
notifyLabel.Size = UDim2.new(1, 0, 1, 0)
notifyLabel.BackgroundTransparency = 1
notifyLabel.TextColor3 = COLORS.TXT_MAIN
notifyLabel.TextStrokeTransparency = 0.7
notifyLabel.Font = Enum.Font.GothamBold
notifyLabel.TextSize = 18
notifyLabel.Text = ""
notifyLabel.TextStrokeColor3 = Color3.fromRGB(25,25,25)
notifyLabel.Visible = false
notifyLabel.BackgroundColor3 = COLORS.BG_SCRIPT_BADGE
notifyLabel.ZIndex = 1000
notifyLabel.Parent = notifyFrame
local notifyCorner = Instance.new("UICorner")
notifyCorner.CornerRadius = UDim.new(1,0)
notifyCorner.Parent = notifyLabel

local function showNotification(text, color)
    notifyLabel.Text = text
    notifyLabel.BackgroundColor3 = color or COLORS.BG_SCRIPT_BADGE
    notifyLabel.Visible = true
    notifyLabel.BackgroundTransparency = 0.15
    notifyLabel.TextTransparency = 0
    TweenService:Create(notifyLabel, TweenInfo.new(0.25), {BackgroundTransparency=0.15, TextTransparency=0}):Play()
    delay(3, function()
        TweenService:Create(notifyLabel, TweenInfo.new(0.6), {BackgroundTransparency=1, TextTransparency=1}):Play()
        wait(0.62)
        notifyLabel.Visible = false
    end)
end

-- Funktion zum Erstellen eines User Indicators
local function createUserIndicator(targetPlayer)
    if not targetPlayer.Character or not targetPlayer.Character:FindFirstChild("Head") then
        return nil
    end

    local head = targetPlayer.Character.Head
    
    -- Prüfe ob bereits ein Indicator existiert
    if head:FindFirstChild("AnonHubIndicator") then
        head:FindFirstChild("AnonHubIndicator"):Destroy()
    end
    
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "AnonHubIndicator"
    billboard.Adornee = head
    billboard.Size = UDim2.new(0, 160, 0, 30)
    billboard.StudsOffset = Vector3.new(0, 3.5, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = head

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundColor3 = COLORS.BG_VIP
    frame.BackgroundTransparency = 0.1
    frame.BorderSizePixel = 0
    frame.Parent = billboard

    local frameCorner = Instance.new("UICorner")
    frameCorner.CornerRadius = UDim.new(0, 15)
    frameCorner.Parent = frame

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = USER_DETECTION.INDICATOR_TEXT
    label.TextColor3 = COLORS.TXT_VIP
    label.Font = Enum.Font.GothamBlack
    label.TextSize = 12
    label.TextScaled = true
    label.Parent = frame

    -- Glow effect
    local glow = Instance.new("Frame")
    glow.Size = UDim2.new(1, 4, 1, 4)
    glow.Position = UDim2.new(0, -2, 0, -2)
    glow.BackgroundColor3 = USER_DETECTION.INDICATOR_COLOR
    glow.BackgroundTransparency = 0.7
    glow.BorderSizePixel = 0
    glow.ZIndex = -1
    glow.Parent = frame

    local glowCorner = Instance.new("UICorner")
    glowCorner.CornerRadius = UDim.new(0, 17)
    glowCorner.Parent = glow

    -- Animation
    frame.BackgroundTransparency = 1
    label.TextTransparency = 1
    TweenService:Create(frame, TweenInfo.new(0.5), {BackgroundTransparency = 0.1}):Play()
    TweenService:Create(label, TweenInfo.new(0.5), {TextTransparency = 0}):Play()

    return billboard
end

-- Funktion für PlayerGui Detection
local function setupUserDetection()
    local function checkPlayerForAnonHub(targetPlayer)
        if targetPlayer == player then return end
        
        local playerGui = targetPlayer:FindFirstChild("PlayerGui")
        if playerGui and playerGui:FindFirstChild("AnonHub") then
            if not detectedUsers[targetPlayer] then
                detectedUsers[targetPlayer] = true
                userIndicators[targetPlayer] = createUserIndicator(targetPlayer)
                
                if USER_DETECTION.SHOW_NOTIFICATIONS and showNotification then
                    showNotification("🔍 AnonHub User: " .. targetPlayer.Name, COLORS.BG_VIP)
                end
            end
        else
            if detectedUsers[targetPlayer] then
                detectedUsers[targetPlayer] = nil
                if userIndicators[targetPlayer] then
                    userIndicators[targetPlayer]:Destroy()
                    userIndicators[targetPlayer] = nil
                end
            end
        end
    end

    -- Alle aktuellen Spieler überprüfen
    for _, targetPlayer in ipairs(game.Players:GetPlayers()) do
        spawn(function()
            wait(2) -- Warte bis GUIs geladen sind
            checkPlayerForAnonHub(targetPlayer)
        end)
    end

    -- Neue Spieler überwachen
    game.Players.PlayerAdded:Connect(function(targetPlayer)
        spawn(function()
            wait(5) -- Längere Wartezeit für neue Spieler
            checkPlayerForAnonHub(targetPlayer)
        end)
    end)

    -- Spieler verlassen überwachen
    game.Players.PlayerRemoving:Connect(function(targetPlayer)
        if detectedUsers[targetPlayer] then
            detectedUsers[targetPlayer] = nil
            if userIndicators[targetPlayer] then
                userIndicators[targetPlayer]:Destroy()
                userIndicators[targetPlayer] = nil
            end
        end
    end)

    -- Periodische Überprüfung
    spawn(function()
        while USER_DETECTION.ENABLED do
            wait(USER_DETECTION.UPDATE_INTERVAL)
            for _, targetPlayer in ipairs(game.Players:GetPlayers()) do
                checkPlayerForAnonHub(targetPlayer)
            end
        end
    end)

    -- Entfernungsbasierte Sichtbarkeit
    RunService.Heartbeat:Connect(function()
        if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
            return
        end

        local playerPosition = player.Character.HumanoidRootPart.Position

        for targetPlayer, indicator in pairs(userIndicators) do
            if targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                local distance = (playerPosition - targetPlayer.Character.HumanoidRootPart.Position).Magnitude
                local visible = distance <= USER_DETECTION.DETECTION_DISTANCE

                if indicator and indicator.Parent then
                    indicator.Enabled = visible
                end
            end
        end
    end)
end

-- Login Functions
getKeyBtn.MouseButton1Click:Connect(function()
    setclipboard(DISCORD_LINK)
    statusLabel.Text = "Discord link copied! Join Discord to get key."
    statusLabel.TextColor3 = COLORS.GREEN
    showNotification("Discord link copied to clipboard!", COLORS.BG_SCRIPT_BADGE)
end)

loginBtn.MouseButton1Click:Connect(function()
    if keyBox.Text == VALID_KEY then
        statusLabel.Text = "Login successful!"
        statusLabel.TextColor3 = COLORS.GREEN
        showNotification("Access granted! Welcome to AnonHub", COLORS.GREEN)
        wait(1)
        loginFrame:Destroy()
        -- Initialize main UI
        initMainUI()
    else
        statusLabel.Text = "Invalid key! Join Discord to get the key."
        statusLabel.TextColor3 = COLORS.RED
        showNotification("Invalid key!", COLORS.RED)
    end
end)

function initMainUI()
    local scriptData = {
        {name="Voice Chat Unban", url="https://pastebin.com/raw/QV2E9LxH"},
        {name="Blox Fruits", url="https://cdn.robloxscripts.gg/public/lpscript/lpscript-redz-hub-source.lua"},
        {name="Fly Script", url="https://raw.githubusercontent.com/mikeexc/Dsc-Mike-Fly-Gui/main/Fly%20Gui"},
        {name="Jerk Animation", url="https://pastefy.app/YZoglOyJ/raw"},
        {name="Natural Disaster Surv", url="https://raw.githubusercontent.com/ddario66/Test/refs/heads/main/Nature%20disaster"},
        {name="Prison Life", url="https://raw.githubusercontent.com/DataApples/libraries/refs/heads/main/File"},
        {name="Dead Rails", url="https://paste.ee/r/vz03WynD"},
        {name="Bubble Gum Simulator", url="https://raw.githubusercontent.com/Amazonek123/LoaderWrapGate/refs/heads/main/Loader.lua"},
        {name="Arsenal", url="https://pastebin.com/raw/hUKpTMLf"},
        {name="Gro A Fish Pond", url="https://github.com/alyssagithub/Scripts/raw/main/FrostByte/Initiate.lua"},
        {name="Taxi Boss", url="https://raw.githubusercontent.com/iz037/Zeld-Hub/main/Loader.lua"},
        {name="Universal Admin", url="https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"},
        {name="Inhuman", url="https://pastefy.app/8LJ8KlON/raw?part=Inhuman"},
        {name="Steal a Fish", url="https://skid.sown.zip/AutoFarm.luau"},
        {name="Lucky Blocks", url="https://raw.githubusercontent.com/vortex-script/Lucky-Block-BattleGround-script/main/Main.lua"},
        {name="Murder Mystery 2", url="https://raw.githubusercontent.com/Pa1nx/MurderMystery2ScriptTESTING/main/TestFile"},
        {name="Build an Island", url="https://raw.githubusercontent.com/HeroReaI/losl123/refs/heads/main/2gv2gg.lua"},
        {name="Steal a Brainrot", url="https://raw.githubusercontent.com/gumanba/Scripts/refs/heads/main/StealaBrainrot"},
        {name="Slap Tower", url="https://pastebin.com/raw/SYTwsPFG"},
        {name="Tower of Hell", url="https://coolxplo.github.io/DP-HUB-coolxplo/Tower%20Of%20Hell.lua"},
        {name="Grow A Garden", url="https://raw.githubusercontent.com/Kenniel123/Grow-a-garden/refs/heads/main/Grow%20A%20Garden"},
        {name="Basketball Zero", url="https://raw.githubusercontent.com/HmizoBeamzz/BASKETBBAALALALALLA/refs/heads/main/aebee82462efd758.txt"},
        {name="Rivals", url="https://raw.githubusercontent.com/showsix/rivals/refs/heads/main/script"},
    }
    local scriptUsage = {}

    local frameWidth, frameHeight, sidebarWidth = 800, 500, 220

    -- Main Frame
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, frameWidth, 0, frameHeight)
    frame.Position = UDim2.new(0.5, -frameWidth/2, 0.5, -frameHeight/2)
    frame.AnchorPoint = Vector2.new(0.5, 0.5)
    frame.BackgroundColor3 = COLORS.BG_MAIN
    frame.BorderColor3 = COLORS.BORDER
    frame.BorderSizePixel = 1
    frame.Active = true
    frame.ZIndex = 10
    frame.Parent = screenGui
    local frameCorner = Instance.new("UICorner")
    frameCorner.CornerRadius = UDim.new(0, 20)
    frameCorner.Parent = frame

    -- Sidebar
    local buttonNames = {"Homepage", "Scripts", "Utility", "VIP", "Social Media"}
    local sidebar = Instance.new("Frame")
    sidebar.Size = UDim2.new(0, sidebarWidth, 1, 0)
    sidebar.Position = UDim2.new(0, 0, 0, 0)
    sidebar.BackgroundColor3 = COLORS.BG_SIDEBAR
    sidebar.BorderSizePixel = 0
    sidebar.ZIndex = 12
    sidebar.Parent = frame
    local sidebarCorner = Instance.new("UICorner")
    sidebarCorner.CornerRadius = UDim.new(0, 18)
    sidebarCorner.Parent = sidebar

    local logo = Instance.new("TextLabel")
    logo.Text = "AnonHub"
    logo.Font = Enum.Font.GothamBlack
    logo.TextSize = 28
    logo.TextColor3 = COLORS.TXT_ACCENT
    logo.BackgroundTransparency = 1
    logo.Size = UDim2.new(1, -20, 0, 50)
    logo.Position = UDim2.new(0, 15, 0, 15)
    logo.TextXAlignment = Enum.TextXAlignment.Left
    logo.ZIndex = 15
    logo.Parent = sidebar

    local sidebarButtons, sidebarIcons = {}, {}
    local buttonHeight, spacing, startY = 45, 12, 75

    for i, btnName in ipairs(buttonNames) do
        local btn = Instance.new("TextButton")
        btn.Text = "     " .. btnName
        btn.Name = btnName.."Btn"
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 18
        btn.TextColor3 = COLORS.TXT_SIDEBAR
        btn.BackgroundColor3 = btnName == "VIP" and COLORS.BG_VIP or COLORS.BG_SIDEBAR_BTN
        btn.Size = UDim2.new(1, -24, 0, buttonHeight)
        btn.Position = UDim2.new(0, 12, 0, startY + (i-1)*(buttonHeight+spacing))
        btn.AutoButtonColor = false
        btn.ZIndex = 14
        btn.Parent = sidebar
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 12)
        btnCorner.Parent = btn
        sidebarButtons[btnName] = btn

        if btnName == "VIP" then
            btn.TextColor3 = COLORS.TXT_VIP
        end

        local icon = Instance.new("ImageLabel")
        icon.Image = ICONS[btnName] or ""
        icon.BackgroundTransparency = 1
        icon.Size = UDim2.new(0, 24, 0, 24)
        icon.Position = UDim2.new(0, 12, 0.5, -12)
        icon.ImageColor3 = btnName == "VIP" and COLORS.TXT_VIP or COLORS.TXT_SIDEBAR
        icon.ZIndex = 15
        icon.Parent = btn
        sidebarIcons[btnName] = icon
    end

    local function highlightButton(selected)
        for name, btn in pairs(sidebarButtons) do
            if name == selected then
                if name == "VIP" then
                    TweenService:Create(btn, TweenInfo.new(0.18), {
                        BackgroundColor3 = Color3.fromRGB(255, 200, 0),
                        TextColor3 = COLORS.TXT_VIP
                    }):Play()
                    sidebarIcons[name].ImageColor3 = COLORS.TXT_VIP
                else
                    TweenService:Create(btn, TweenInfo.new(0.18), {
                        BackgroundColor3 = COLORS.BG_SIDEBAR_BTN_SELECTED,
                        TextColor3 = COLORS.TXT_SIDEBAR_SELECTED
                    }):Play()
                    sidebarIcons[name].ImageColor3 = COLORS.TXT_SIDEBAR_SELECTED
                end
            else
                if name == "VIP" then
                    TweenService:Create(btn, TweenInfo.new(0.18), {
                        BackgroundColor3 = COLORS.BG_VIP,
                        TextColor3 = COLORS.TXT_VIP
                    }):Play()
                    sidebarIcons[name].ImageColor3 = COLORS.TXT_VIP
                else
                    TweenService:Create(btn, TweenInfo.new(0.18), {
                        BackgroundColor3 = COLORS.BG_SIDEBAR_BTN,
                        TextColor3 = COLORS.TXT_SIDEBAR
                    }):Play()
                    sidebarIcons[name].ImageColor3 = COLORS.TXT_SIDEBAR
                end
            end
        end
    end

    local bottom = Instance.new("TextLabel")
    bottom.Text = "by AnonHub Team"
    bottom.Font = Enum.Font.Gotham
    bottom.TextSize = 12
    bottom.TextColor3 = COLORS.TXT_MUTED
    bottom.BackgroundTransparency = 1
    bottom.Size = UDim2.new(1, -20, 0, 20)
    bottom.Position = UDim2.new(0, 12, 1, -30)
    bottom.TextXAlignment = Enum.TextXAlignment.Left
    bottom.ZIndex = 16
    bottom.Parent = sidebar

    local contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(1, -sidebarWidth, 1, 0)
    contentFrame.Position = UDim2.new(0, sidebarWidth, 0, 0)
    contentFrame.BackgroundTransparency = 1
    contentFrame.ZIndex = 20
    contentFrame.Parent = frame

    local pages = {}

    -- Homepage
    local homePage = Instance.new("Frame")
    homePage.Size = UDim2.new(1, 0, 1, 0)
    homePage.Position = UDim2.new(0, 0, 0, 0)
    homePage.BackgroundColor3 = COLORS.BG_MAIN
    homePage.BorderSizePixel = 0
    homePage.ZIndex = 21
    homePage.Parent = contentFrame
    pages["Homepage"] = homePage

    local homeCorner = Instance.new("UICorner")
    homeCorner.CornerRadius = UDim.new(0, 20)
    homeCorner.Parent = homePage

    local homeTitle = Instance.new("TextLabel")
    homeTitle.Text = "Welcome to AnonHub!"
    homeTitle.Font = Enum.Font.GothamBlack
    homeTitle.TextSize = 28
    homeTitle.TextColor3 = COLORS.TXT_ACCENT
    homeTitle.BackgroundTransparency = 1
    homeTitle.Size = UDim2.new(1, -30, 0, 50)
    homeTitle.Position = UDim2.new(0, 20, 0, 30)
    homeTitle.TextXAlignment = Enum.TextXAlignment.Left
    homeTitle.ZIndex = 23
    homeTitle.Parent = homePage

    local homeInfo = Instance.new("TextLabel")
    homeInfo.Text = "AnonHub is your premium hub for scripts, utilities & community access."
    homeInfo.Font = Enum.Font.Gotham
    homeInfo.TextSize = 16
    homeInfo.TextColor3 = COLORS.TXT_MAIN
    homeInfo.BackgroundTransparency = 1
    homeInfo.Size = UDim2.new(1, -30, 0, 60)
    homeInfo.Position = UDim2.new(0, 20, 0, 85)
    homeInfo.TextWrapped = true
    homeInfo.TextXAlignment = Enum.TextXAlignment.Left
    homeInfo.ZIndex = 23
    homeInfo.Parent = homePage

    -- Scripts Page
    local scriptsPage = Instance.new("Frame")
    scriptsPage.Size = UDim2.new(1, 0, 1, 0)
    scriptsPage.Position = UDim2.new(0, 0, 0, 0)
    scriptsPage.BackgroundColor3 = COLORS.BG_MAIN
    scriptsPage.BorderSizePixel = 0
    scriptsPage.ZIndex = 21
    scriptsPage.Visible = false
    scriptsPage.Parent = contentFrame
    pages["Scripts"] = scriptsPage

    local scriptsCorner = Instance.new("UICorner")
    scriptsCorner.CornerRadius = UDim.new(0, 20)
    scriptsCorner.Parent = scriptsPage

    local scriptsTitle = Instance.new("TextLabel")
    scriptsTitle.Text = "Scripts"
    scriptsTitle.Font = Enum.Font.GothamBlack
    scriptsTitle.TextSize = 28
    scriptsTitle.TextColor3 = COLORS.TXT_ACCENT
    scriptsTitle.BackgroundTransparency = 1
    scriptsTitle.Size = UDim2.new(1, -30, 0, 40)
    scriptsTitle.Position = UDim2.new(0, 20, 0, 20)
    scriptsTitle.TextXAlignment = Enum.TextXAlignment.Left
    scriptsTitle.ZIndex = 23
    scriptsTitle.Parent = scriptsPage

    local searchBox = Instance.new("TextBox")
    searchBox.PlaceholderText = "Search scripts..."
    searchBox.Text = ""
    searchBox.Font = Enum.Font.Gotham
    searchBox.TextSize = 16
    searchBox.TextColor3 = COLORS.TXT_MAIN
    searchBox.BackgroundColor3 = COLORS.BG_SEARCH
    searchBox.Size = UDim2.new(0, 250, 0, 32)
    searchBox.Position = UDim2.new(0, 20, 0, 70)
    searchBox.BorderSizePixel = 0
    searchBox.ClearTextOnFocus = false
    searchBox.ZIndex = 24
    searchBox.PlaceholderColor3 = COLORS.TXT_PLACEHOLDER
    searchBox.Parent = scriptsPage
    local searchCorner = Instance.new("UICorner")
    searchCorner.CornerRadius = UDim.new(0, 8)
    searchCorner.Parent = searchBox

    local scroll = Instance.new("ScrollingFrame")
    scroll.Size = UDim2.new(1, -40, 1, -120)
    scroll.Position = UDim2.new(0, 20, 0, 110)
    scroll.CanvasSize = UDim2.new(0,0,0,0)
    scroll.ScrollBarThickness = 6
    scroll.ScrollBarImageColor3 = COLORS.BG_SCROLLBAR
    scroll.BackgroundTransparency = 1
    scroll.BorderSizePixel = 0
    scroll.ZIndex = 22
    scroll.Parent = scriptsPage

    local grid = Instance.new("UIGridLayout")
    grid.CellSize = UDim2.new(0.48, 0, 0, 50)
    grid.CellPadding = UDim2.new(0, 12, 0, 12)
    grid.FillDirection = Enum.FillDirection.Horizontal
    grid.SortOrder = Enum.SortOrder.LayoutOrder
    grid.StartCorner = Enum.StartCorner.TopLeft
    grid.HorizontalAlignment = Enum.HorizontalAlignment.Left
    grid.VerticalAlignment = Enum.VerticalAlignment.Top
    grid.FillDirectionMaxCells = 2
    grid.Parent = scroll

    local scriptButtons = {}
    local function renderScriptButtons(filter)
        for _, btn in pairs(scriptButtons) do btn:Destroy() end
        scriptButtons = {}
        local filtered = {}
        for _, s in ipairs(scriptData) do
            if not filter or filter == "" or string.find(s.name:lower(), filter:lower(), 1, true) then
                table.insert(filtered, s)
            end
        end
        for _, data in ipairs(filtered) do
            local btn = Instance.new("TextButton")
            btn.Text = "     " .. data.name
            btn.Font = Enum.Font.GothamBold
            btn.TextSize = 16
            btn.TextColor3 = COLORS.TXT_MAIN
            btn.BackgroundColor3 = COLORS.BG_SCRIPT
            btn.Size = UDim2.new(0, 160, 0, 50)
            btn.AutoButtonColor = true
            btn.ZIndex = 24
            btn.Parent = scroll
            btn.ClipsDescendants = true
            btn.BorderSizePixel = 0

            local btnCorner = Instance.new("UICorner")
            btnCorner.CornerRadius = UDim.new(0, 10)
            btnCorner.Parent = btn

            local badge = Instance.new("Frame")
            badge.Size = UDim2.new(0, 10, 0, 10)
            badge.Position = UDim2.new(0, 10, 0.5, -5)
            badge.BackgroundColor3 = COLORS.GREEN
            badge.BorderSizePixel = 0
            badge.ZIndex = 25
            badge.Parent = btn
            local badgeCorner = Instance.new("UICorner")
            badgeCorner.CornerRadius = UDim.new(1,0)
            badgeCorner.Parent = badge

            local counter = Instance.new("TextLabel")
            local count = scriptUsage[data.name] or 0
            counter.Text = tostring(count)
            counter.Font = Enum.Font.Gotham
            counter.TextSize = 12
            counter.TextColor3 = COLORS.TXT_MUTED
            counter.BackgroundTransparency = 1
            counter.Size = UDim2.new(0, 24, 0, 18)
            counter.Position = UDim2.new(1, -26, 0.5, -9)
            counter.ZIndex = 26
            counter.TextXAlignment = Enum.TextXAlignment.Right
            counter.Parent = btn

            btn.MouseButton1Click:Connect(function()
                local success, err = pcall(function()
                    scriptUsage[data.name] = (scriptUsage[data.name] or 0) + 1
                    counter.Text = tostring(scriptUsage[data.name])
                    loadstring(game:HttpGet(data.url))()
                end)
                if success then
                    showNotification("✅ Script executed: " .. data.name, COLORS.BG_SCRIPT_BADGE)
                else
                    showNotification("❌ Error loading: " .. data.name, COLORS.RED)
                end
            end)
            scriptButtons[#scriptButtons+1] = btn
        end
        scroll.CanvasSize = UDim2.new(0, 0, 0, math.max(math.ceil(#filtered/2)*(50+12)-12, 10))
    end

    searchBox:GetPropertyChangedSignal("Text"):Connect(function()
        renderScriptButtons(searchBox.Text)
    end)
    renderScriptButtons("")

    -- Utility Page with Better Layout
    local utilityPage = Instance.new("Frame")
    utilityPage.Size = UDim2.new(1, 0, 1, 0)
    utilityPage.Position = UDim2.new(0, 0, 0, 0)
    utilityPage.BackgroundColor3 = COLORS.BG_MAIN
    utilityPage.BorderSizePixel = 0
    utilityPage.ZIndex = 21
    utilityPage.Visible = false
    utilityPage.Parent = contentFrame
    pages["Utility"] = utilityPage

    local utilityCorner = Instance.new("UICorner")
    utilityCorner.CornerRadius = UDim.new(0, 20)
    utilityCorner.Parent = utilityPage

    local utilTitle = Instance.new("TextLabel")
    utilTitle.Text = "Utility Functions"
    utilTitle.Font = Enum.Font.GothamBlack
    utilTitle.TextSize = 28
    utilTitle.TextColor3 = COLORS.TXT_ACCENT
    utilTitle.BackgroundTransparency = 1
    utilTitle.Size = UDim2.new(1, -30, 0, 40)
    utilTitle.Position = UDim2.new(0, 20, 0, 20)
    utilTitle.TextXAlignment = Enum.TextXAlignment.Left
    utilTitle.ZIndex = 23
    utilTitle.Parent = utilityPage

    -- Utility Scroll Frame
    local utilScroll = Instance.new("ScrollingFrame")
    utilScroll.Size = UDim2.new(1, -40, 1, -80)
    utilScroll.Position = UDim2.new(0, 20, 0, 70)
    utilScroll.CanvasSize = UDim2.new(0,0,0,600)
    utilScroll.ScrollBarThickness = 6
    utilScroll.ScrollBarImageColor3 = COLORS.BG_SCROLLBAR
    utilScroll.BackgroundTransparency = 1
    utilScroll.BorderSizePixel = 0
    utilScroll.ZIndex = 22
    utilScroll.Parent = utilityPage

    -- Utility Functions with Better Layout
    local utilFunctions = {
        {name = "Godmode", pos = Vector2.new(0, 0)},
        {name = "Speed Hack", pos = Vector2.new(140, 0)},
        {name = "Jump Power", pos = Vector2.new(280, 0)},
        {name = "ESP", pos = Vector2.new(420, 0)},
        {name = "Infinite Jump", pos = Vector2.new(0, 60)},
        {name = "TP to Player", pos = Vector2.new(140, 60)},
        {name = "Rejoin", pos = Vector2.new(280, 60)},
        {name = "Serverhop", pos = Vector2.new(420, 60)},
        {name = "Anti-AFK", pos = Vector2.new(0, 120)},
        {name = "Noclip", pos = Vector2.new(140, 120)},
        {name = "Invisible", pos = Vector2.new(280, 120)},
        {name = "Auto Collect", pos = Vector2.new(420, 120)},
        {name = "Walk on Water", pos = Vector2.new(0, 180)},
        {name = "Gravity", pos = Vector2.new(140, 180)},
        {name = "FOV", pos = Vector2.new(280, 180)},
        {name = "User Detection", pos = Vector2.new(420, 180)},
    }

    -- Create utility buttons
    for _, func in ipairs(utilFunctions) do
        local btn = Instance.new("TextButton")
        btn.Text = func.name
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 14
        btn.TextColor3 = COLORS.TXT_MAIN
        btn.BackgroundColor3 = func.name == "User Detection" and (USER_DETECTION.ENABLED and COLORS.GREEN or COLORS.BG_SIDEBAR_BTN_SELECTED) or COLORS.BG_SIDEBAR_BTN_SELECTED
        btn.Size = UDim2.new(0, 120, 0, 35)
        btn.Position = UDim2.new(0, func.pos.X, 0, func.pos.Y)
        btn.ZIndex = 24
        btn.Parent = utilScroll
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 8)
        btnCorner.Parent = btn
        
        -- Add functionality based on button name
        if func.name == "Godmode" then
            local godmodeActive = false
            btn.MouseButton1Click:Connect(function()
                godmodeActive = not godmodeActive
                btn.BackgroundColor3 = godmodeActive and COLORS.RED or COLORS.BG_SIDEBAR_BTN_SELECTED
                btn.Text = godmodeActive and "Godmode: ON" or "Godmode"
                showNotification(godmodeActive and "Godmode activated!" or "Godmode deactivated!", godmodeActive and COLORS.GREEN or COLORS.RED)
            end)
            game:GetService("RunService").Stepped:Connect(function()
                if godmodeActive then
                    local chr = player.Character
                    if chr and chr:FindFirstChildOfClass("Humanoid") then
                        chr.Humanoid.Health = chr.Humanoid.MaxHealth
                        chr.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Dead, false)
                    end
                end
            end)
        elseif func.name == "Speed Hack" then
            btn.MouseButton1Click:Connect(function()
                if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
                    player.Character.Humanoid.WalkSpeed = player.Character.Humanoid.WalkSpeed == 16 and 50 or 16
                    showNotification("Speed: " .. player.Character.Humanoid.WalkSpeed, COLORS.GREEN)
                end
            end)
        elseif func.name == "Jump Power" then
            btn.MouseButton1Click:Connect(function()
                if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
                    player.Character.Humanoid.JumpPower = player.Character.Humanoid.JumpPower == 50 and 120 or 50
                    showNotification("Jump Power: " .. player.Character.Humanoid.JumpPower, COLORS.GREEN)
                end
            end)
        elseif func.name == "ESP" then
            local espActive = false
            btn.MouseButton1Click:Connect(function()
                espActive = not espActive
                btn.BackgroundColor3 = espActive and COLORS.RED or COLORS.BG_SIDEBAR_BTN_SELECTED
                btn.Text = espActive and "ESP: ON" or "ESP"
                showNotification(espActive and "ESP activated!" or "ESP deactivated!", espActive and COLORS.GREEN or COLORS.RED)
            end)
        elseif func.name == "Infinite Jump" then
            local infJumpActive = false
            btn.MouseButton1Click:Connect(function()
                infJumpActive = not infJumpActive
                btn.BackgroundColor3 = infJumpActive and COLORS.RED or COLORS.BG_SIDEBAR_BTN_SELECTED
                btn.Text = infJumpActive and "Inf Jump: ON" or "Infinite Jump"
                showNotification(infJumpActive and "Infinite Jump activated!" or "Infinite Jump deactivated!", infJumpActive and COLORS.GREEN or COLORS.RED)
            end)
            UserInputService.JumpRequest:Connect(function()
                if infJumpActive and player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
                    player.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end)
        elseif func.name == "TP to Player" then
            btn.MouseButton1Click:Connect(function()
                local players = {}
                for _, p in ipairs(game.Players:GetPlayers()) do
                    if p ~= player then
                        table.insert(players, p.Name)
                    end
                end
                if #players > 0 then
                    local targetName = players[math.random(#players)]
                    local target = game.Players:FindFirstChild(targetName)
                    if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        player.Character.HumanoidRootPart.CFrame = target.Character.HumanoidRootPart.CFrame + Vector3.new(0,3,0)
                        showNotification("Teleported to " .. targetName, COLORS.GREEN)
                    end
                end
            end)
        elseif func.name == "Rejoin" then
            btn.MouseButton1Click:Connect(function()
                game:GetService("TeleportService"):Teleport(game.PlaceId)
                showNotification("Rejoining...", COLORS.GREEN)
            end)
        elseif func.name == "Serverhop" then
            btn.MouseButton1Click:Connect(function()
                local success, servers = pcall(function()
                    local HttpService = game:GetService("HttpService")
                    return HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=2&limit=100"))
                end)
                if success then
                    for _,s in pairs(servers.data) do
                        if s.playing < s.maxPlayers and s.id ~= game.JobId then
                            game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, s.id)
                            break
                        end
                    end
                end
                showNotification("Finding server...", COLORS.GREEN)
            end)
        elseif func.name == "Anti-AFK" then
            local antiAfkActive = false
            local antiAfkConn
            btn.MouseButton1Click:Connect(function()
                antiAfkActive = not antiAfkActive
                btn.BackgroundColor3 = antiAfkActive and COLORS.RED or COLORS.BG_SIDEBAR_BTN_SELECTED
                btn.Text = antiAfkActive and "Anti-AFK: ON" or "Anti-AFK"
                showNotification(antiAfkActive and "Anti-AFK activated!" or "Anti-AFK deactivated!", antiAfkActive and COLORS.GREEN or COLORS.RED)
                if antiAfkActive then
                    antiAfkConn = player.Idled:Connect(function()
                        local VirtualUser = game:GetService("VirtualUser")
                        VirtualUser:CaptureController()
                        VirtualUser:ClickButton2(Vector2.new())
                    end)
                elseif antiAfkConn then
                    antiAfkConn:Disconnect()
                    antiAfkConn = nil
                end
            end)
        elseif func.name == "Noclip" then
            local noclipActive = false
            local noclipConn
            btn.MouseButton1Click:Connect(function()
                noclipActive = not noclipActive
                btn.BackgroundColor3 = noclipActive and COLORS.RED or COLORS.BG_SIDEBAR_BTN_SELECTED
                btn.Text = noclipActive and "Noclip: ON" or "Noclip"
                if noclipActive then
                    noclipConn = game:GetService("RunService").Stepped:Connect(function()
                        local chr = player.Character
                        if chr then
                            for _, p in ipairs(chr:GetDescendants()) do
                                if p:IsA("BasePart") then
                                    p.CanCollide = false
                                end
                            end
                        end
                    end)
                    showNotification("Noclip activated!", COLORS.GREEN)
                else
                    if noclipConn then noclipConn:Disconnect() noclipConn = nil end
                    local chr = player.Character
                    if chr then
                        for _, p in ipairs(chr:GetDescendants()) do
                            if p:IsA("BasePart") then
                                p.CanCollide = true
                            end
                        end
                    end
                    showNotification("Noclip deactivated!", COLORS.RED)
                end
            end)
        elseif func.name == "Invisible" then
            local invisibleActive = false
            btn.MouseButton1Click:Connect(function()
                invisibleActive = not invisibleActive
                btn.BackgroundColor3 = invisibleActive and COLORS.RED or COLORS.BG_SIDEBAR_BTN_SELECTED
                btn.Text = invisibleActive and "Invisible: ON" or "Invisible"
                local chr = player.Character
                if chr then
                    for _, p in ipairs(chr:GetDescendants()) do
                        if p:IsA("BasePart") and p.Transparency < 1 then
                            p.Transparency = invisibleActive and 1 or 0
                        end
                    end
                end
                showNotification(invisibleActive and "Invisible activated!" or "Invisible deactivated!", invisibleActive and COLORS.GREEN or COLORS.RED)
            end)
        elseif func.name == "Auto Collect" then
            local autoCollectActive = false
            local autoCollectConn
            btn.MouseButton1Click:Connect(function()
                autoCollectActive = not autoCollectActive
                btn.BackgroundColor3 = autoCollectActive and COLORS.RED or COLORS.BG_SIDEBAR_BTN_SELECTED
                btn.Text = autoCollectActive and "Auto Collect: ON" or "Auto Collect"
                showNotification(autoCollectActive and "Auto Collect activated!" or "Auto Collect deactivated!", autoCollectActive and COLORS.GREEN or COLORS.RED)
                if autoCollectActive then
                    autoCollectConn = game:GetService("RunService").Heartbeat:Connect(function()
                        for _,obj in ipairs(workspace:GetDescendants()) do
                            if obj:IsA("TouchTransmitter") and obj.Parent and obj.Parent:IsA("BasePart") then
                                pcall(function()
                                    firetouchinterest(player.Character.HumanoidRootPart, obj.Parent, 0)
                                end)
                            end
                        end
                    end)
                elseif autoCollectConn then
                    autoCollectConn:Disconnect()
                    autoCollectConn = nil
                end
            end)
        elseif func.name == "Walk on Water" then
            local wowActive = false
            local wowConn
            btn.MouseButton1Click:Connect(function()
                wowActive = not wowActive
                btn.BackgroundColor3 = wowActive and COLORS.RED or COLORS.BG_SIDEBAR_BTN_SELECTED
                btn.Text = wowActive and "WOW: ON" or "Walk on Water"
                showNotification(wowActive and "Walk on Water activated!" or "Walk on Water deactivated!", wowActive and COLORS.GREEN or COLORS.RED)
                if wowActive then
                    wowConn = game:GetService("RunService").Heartbeat:Connect(function()
                        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                            local hrp = player.Character.HumanoidRootPart
                            local ray = workspace:FindPartOnRayWithWhitelist(Ray.new(hrp.Position, Vector3.new(0,-10,0)), {workspace.Terrain})
                            if ray then
                                if hrp.Position.Y < workspace.FallenPartsDestroyHeight+10 then
                                    hrp.Velocity = Vector3.new(hrp.Velocity.X, 0, hrp.Velocity.Z)
                                    hrp.CFrame = hrp.CFrame + Vector3.new(0,0.15,0)
                                end
                            end
                        end
                    end)
                elseif wowConn then
                    wowConn:Disconnect()
                    wowConn = nil
                end
            end)
        elseif func.name == "Gravity" then
            btn.MouseButton1Click:Connect(function()
                workspace.Gravity = workspace.Gravity == 196.2 and 50 or 196.2
                showNotification("Gravity: " .. workspace.Gravity, COLORS.GREEN)
            end)
        elseif func.name == "FOV" then
            btn.MouseButton1Click:Connect(function()
                workspace.CurrentCamera.FieldOfView = workspace.CurrentCamera.FieldOfView == 70 and 120 or 70
                showNotification("FOV: " .. workspace.CurrentCamera.FieldOfView, COLORS.GREEN)
            end)
        elseif func.name == "User Detection" then
            btn.MouseButton1Click:Connect(function()
                USER_DETECTION.ENABLED = not USER_DETECTION.ENABLED
                btn.BackgroundColor3 = USER_DETECTION.ENABLED and COLORS.GREEN or COLORS.BG_SIDEBAR_BTN_SELECTED
                btn.Text = USER_DETECTION.ENABLED and "Detection: ON" or "User Detection"
                
                if USER_DETECTION.ENABLED then
                    setupUserDetection()
                    showNotification("🔍 User Detection aktiviert!", COLORS.GREEN)
                else
                    -- Alle Indicators entfernen
                    for targetPlayer, indicator in pairs(userIndicators) do
                        if indicator then
                            indicator:Destroy()
                        end
                    end
                    detectedUsers = {}
                    userIndicators = {}
                    showNotification("🔍 User Detection deaktiviert!", COLORS.RED)
                end
            end)
        end
    end

    -- VIP Page - Modified to only have German Voice Admin button
    local vipPage = Instance.new("Frame")
    vipPage.Size = UDim2.new(1, 0, 1, 0)
    vipPage.Position = UDim2.new(0, 0, 0, 0)
    vipPage.BackgroundColor3 = COLORS.BG_MAIN
    vipPage.BorderSizePixel = 0
    vipPage.ZIndex = 21
    vipPage.Visible = false
    vipPage.Parent = contentFrame
    pages["VIP"] = vipPage

    local vipCorner = Instance.new("UICorner")
    vipCorner.CornerRadius = UDim.new(0, 20)
    vipCorner.Parent = vipPage

    local vipTitle = Instance.new("TextLabel")
    vipTitle.Text = "VIP Functions"
    vipTitle.Font = Enum.Font.GothamBlack
    vipTitle.TextSize = 28
    vipTitle.TextColor3 = COLORS.BG_VIP
    vipTitle.BackgroundTransparency = 1
    vipTitle.Size = UDim2.new(1, -30, 0, 40)
    vipTitle.Position = UDim2.new(0, 20, 0, 20)
    vipTitle.TextXAlignment = Enum.TextXAlignment.Left
    vipTitle.ZIndex = 23
    vipTitle.Parent = vipPage

    local vipInfo = Instance.new("TextLabel")
    vipInfo.Text = "Premium features for VIP members only!"
    vipInfo.Font = Enum.Font.Gotham
    vipInfo.TextSize = 16
    vipInfo.TextColor3 = COLORS.TXT_MAIN
    vipInfo.BackgroundTransparency = 1
    vipInfo.Size = UDim2.new(1, -30, 0, 30)
    vipInfo.Position = UDim2.new(0, 20, 0, 65)
    vipInfo.TextXAlignment = Enum.TextXAlignment.Left
    vipInfo.ZIndex = 23
    vipInfo.Parent = vipPage

    -- German Voice Admin Button
    local germanVoiceBtn = Instance.new("TextButton")
    germanVoiceBtn.Text = "German Voice Admin"
    germanVoiceBtn.Font = Enum.Font.GothamBlack
    germanVoiceBtn.TextSize = 20
    germanVoiceBtn.TextColor3 = COLORS.TXT_VIP
    germanVoiceBtn.BackgroundColor3 = COLORS.BG_VIP
    germanVoiceBtn.Size = UDim2.new(0, 300, 0, 60)
    germanVoiceBtn.Position = UDim2.new(0.5, -150, 0.5, -30)
    germanVoiceBtn.ZIndex = 24
    germanVoiceBtn.Parent = vipPage
    local germanVoiceBtnCorner = Instance.new("UICorner")
    germanVoiceBtnCorner.CornerRadius = UDim.new(0, 15)
    germanVoiceBtnCorner.Parent = germanVoiceBtn

    -- Add glow effect to the button
    local germanVoiceGlow = Instance.new("Frame")
    germanVoiceGlow.Size = UDim2.new(1, 10, 1, 10)
    germanVoiceGlow.Position = UDim2.new(0, -5, 0, -5)
    germanVoiceGlow.BackgroundColor3 = COLORS.BG_VIP
    germanVoiceGlow.BackgroundTransparency = 0.7
    germanVoiceGlow.ZIndex = 23
    germanVoiceGlow.Parent = germanVoiceBtn
    local germanVoiceGlowCorner = Instance.new("UICorner")
    germanVoiceGlowCorner.CornerRadius = UDim.new(0, 20)
    germanVoiceGlowCorner.Parent = germanVoiceGlow

    germanVoiceBtn.MouseButton1Click:Connect(function()
        -- Add your German Voice Admin script here
        local success, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com"))()
        end)
        if success then
            showNotification("🇩🇪 German Voice Admin cannot inject. Ur not VIP!", COLORS.BG_VIP)
        else
            showNotification("❌ Error loading German Voice Admin", COLORS.RED)
        end
    end)

    -- Social Media Page
    local socialPage = Instance.new("Frame")
    socialPage.Size = UDim2.new(1, 0, 1, 0)
    socialPage.Position = UDim2.new(0, 0, 0, 0)
    socialPage.BackgroundColor3 = COLORS.BG_MAIN
    socialPage.BorderSizePixel = 0
    socialPage.ZIndex = 21
    socialPage.Visible = false
    socialPage.Parent = contentFrame
    pages["Social Media"] = socialPage

    local socialCorner = Instance.new("UICorner")
    socialCorner.CornerRadius = UDim.new(0, 20)
    socialCorner.Parent = socialPage

    local socialTitle = Instance.new("TextLabel")
    socialTitle.Text = "Connect with us!"
    socialTitle.Font = Enum.Font.GothamBlack
    socialTitle.TextSize = 28
    socialTitle.TextColor3 = COLORS.TXT_ACCENT
    socialTitle.BackgroundTransparency = 1
    socialTitle.Size = UDim2.new(1, -30, 0, 40)
    socialTitle.Position = UDim2.new(0, 20, 0, 20)
    socialTitle.TextXAlignment = Enum.TextXAlignment.Left
    socialTitle.ZIndex = 23
    socialTitle.Parent = socialPage

    local discordBtn = Instance.new("TextButton")
    discordBtn.Text = "Join Discord Server"
    discordBtn.Font = Enum.Font.GothamBold
    discordBtn.TextSize = 18
    discordBtn.TextColor3 = COLORS.TXT_MAIN
    discordBtn.BackgroundColor3 = Color3.fromRGB(114, 137, 218)
    discordBtn.Size = UDim2.new(0, 200, 0, 50)
    discordBtn.Position = UDim2.new(0, 20, 0, 80)
    discordBtn.ZIndex = 24
    discordBtn.Parent = socialPage
    local discordBtnCorner = Instance.new("UICorner")
    discordBtnCorner.CornerRadius = UDim.new(0, 12)
    discordBtnCorner.Parent = discordBtn

    discordBtn.MouseButton1Click:Connect(function()
        setclipboard(DISCORD_LINK)
        showNotification("Discord link copied to clipboard!", COLORS.GREEN)
    end)

    -- Page Switching
    local currentPage = "Homepage"
    local function switchPage(pageName)
        for _, name in ipairs(buttonNames) do
            if pages[name] then
                pages[name].Visible = (name == pageName)
            end
        end
        currentPage = pageName
        highlightButton(pageName)
    end

    for _, btnName in ipairs(buttonNames) do
        sidebarButtons[btnName].MouseButton1Click:Connect(function()
            switchPage(btnName)
        end)
    end
    switchPage("Homepage")

    -- Hub Toggle Button Functionality
    local hubVisible = true
    hubToggleBtn.MouseButton1Click:Connect(function()
        hubVisible = not hubVisible
        if hubVisible then
            frame.Visible = true
            TweenService:Create(frame, TweenInfo.new(0.3), {
                Position = UDim2.new(0.5, -frameWidth/2, 0.5, -frameHeight/2),
                Size = UDim2.new(0, frameWidth, 0, frameHeight)
            }):Play()
            hubToggleBtn.BackgroundColor3 = COLORS.BG_MAIN
            hubToggleBtn.TextColor3 = COLORS.TXT_ACCENT
            showNotification("AnonHub opened!", COLORS.GREEN)
        else
            TweenService:Create(frame, TweenInfo.new(0.3), {
                Position = UDim2.new(0.5, -frameWidth/2, -1, 0),
                Size = UDim2.new(0, frameWidth, 0, frameHeight)
            }):Play()
            wait(0.3)
            frame.Visible = false
            hubToggleBtn.BackgroundColor3 = COLORS.BG_SIDEBAR_BTN_SELECTED
            hubToggleBtn.TextColor3 = COLORS.TXT_MAIN
            showNotification("AnonHub minimized!", COLORS.RED)
        end
    end)

    -- Minimize/Restore
    local minBtn = Instance.new("TextButton")
    minBtn.Text = "—"
    minBtn.Font = Enum.Font.GothamBold
    minBtn.TextSize = 28
    minBtn.TextColor3 = COLORS.TXT_ACCENT
    minBtn.BackgroundColor3 = COLORS.BG_SIDEBAR
    minBtn.Size = UDim2.new(0, 35, 0, 35)
    minBtn.Position = UDim2.new(1, -45, 0, 5)
    minBtn.AutoButtonColor = true
    minBtn.ZIndex = 100
    minBtn.Parent = frame
    local minBtnCorner = Instance.new("UICorner")
    minBtnCorner.CornerRadius = UDim.new(0, 12)
    minBtnCorner.Parent = minBtn

    local restoreBtn = Instance.new("TextButton")
    restoreBtn.Text = "⭑"
    restoreBtn.Font = Enum.Font.GothamBold
    restoreBtn.TextSize = 24
    restoreBtn.TextColor3 = COLORS.TXT_ACCENT
    restoreBtn.BackgroundColor3 = COLORS.BG_SIDEBAR
    restoreBtn.Size = UDim2.new(0, 50, 0, 50)
    restoreBtn.Position = UDim2.new(1, -60, 1, -60)
    restoreBtn.AnchorPoint = Vector2.new(0, 0)
    restoreBtn.Visible = false
    restoreBtn.ZIndex = 200
    restoreBtn.Parent = screenGui
    local restoreBtnCorner = Instance.new("UICorner")
    restoreBtnCorner.CornerRadius = UDim.new(1, 0)
    restoreBtnCorner.Parent = restoreBtn

    minBtn.MouseButton1Click:Connect(function()
        hubVisible = false
        TweenService:Create(frame, TweenInfo.new(0.3), {
            Position = UDim2.new(0.5, -frameWidth/2, -1, 0),
            Size = UDim2.new(0, frameWidth, 0, frameHeight)
        }):Play()
        wait(0.3)
        frame.Visible = false
        hubToggleBtn.BackgroundColor3 = COLORS.BG_SIDEBAR_BTN_SELECTED
        hubToggleBtn.TextColor3 = COLORS.TXT_MAIN
        restoreBtn.Visible = true
    end)
    restoreBtn.MouseButton1Click:Connect(function()
        hubVisible = true
        restoreBtn.Visible = false
        frame.Visible = true
        TweenService:Create(frame, TweenInfo.new(0.3), {
            Position = UDim2.new(0.5, -frameWidth/2, 0.5, -frameHeight/2),
            Size = UDim2.new(0, frameWidth, 0, frameHeight)
        }):Play()
        hubToggleBtn.BackgroundColor3 = COLORS.BG_MAIN
        hubToggleBtn.TextColor3 = COLORS.TXT_ACCENT
    end)

    -- Drag & Drop
    local dragBar = Instance.new("TextButton")
    dragBar.Text = ""
    dragBar.BackgroundTransparency = 1
    dragBar.Size = UDim2.new(1, 0, 0, 45)
    dragBar.Position = UDim2.new(0, 0, 0, 0)
    dragBar.AutoButtonColor = false
    dragBar.ZIndex = 31
    dragBar.Parent = frame

    local dragging = false
    local dragInput, dragStart, startPos

    dragBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    dragBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            local newPos = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
            frame.Position = newPos
        end
    end)

    -- Watermark
    local watermark = Instance.new("TextLabel")
    watermark.AnchorPoint = Vector2.new(1,1)
    watermark.Position = UDim2.new(1, -16, 1, -8)
    watermark.Size = UDim2.new(0, 150, 0, 30)
    watermark.BackgroundTransparency = 1
    watermark.Parent = screenGui
    watermark.Text = "AnonHub"
    watermark.Font = Enum.Font.GothamBlack
    watermark.TextSize = 28
    watermark.TextColor3 = COLORS.WATERMARK
    watermark.TextTransparency = 0.7
    watermark.ZIndex = 9999

    -- User Detection initialisieren (am Ende von initMainUI hinzufügen)
    if USER_DETECTION.ENABLED then
        spawn(function()
            wait(2) -- Warte bis UI vollständig geladen ist
            setupUserDetection()
            showNotification("🔍 User Detection aktiviert!", COLORS.GREEN)
        end)
    end
end

-- Optional: Console Commands für Debugging
if game:GetService("UserInputService").KeyboardEnabled then
    game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessedEvent)
        if gameProcessedEvent then return end
        
        -- F9 für Debug Info
        if input.KeyCode == Enum.KeyCode.F9 then
            print("=== AnonHub User Detection Debug ===")
            print("Detected Users:", #detectedUsers)
            for player, _ in pairs(detectedUsers) do
                print("- " .. player.Name)
            end
            print("Active Indicators:", #userIndicators)
        end
    end)
end
